# Root .htaccess for drinkmate.sa
RewriteEngine On
Options -MultiViews

# 1) Leave backend (/server) alone so Passenger handles it
RewriteCond %{REQUEST_URI} ^/server [NC]
RewriteRule ^ - [L]

# 2) Route API calls to backend (internal rewrite to /server)
#    So frontend can call /api/... and backend handles it at /server/api/...
RewriteCond %{REQUEST_URI} ^/api [NC]
RewriteRule ^api/(.*)$ /server/api/$1 [L,QSA]

# 3) Route socket.io to backend
RewriteCond %{REQUEST_URI} ^/socket.io [NC]
RewriteRule ^socket.io/(.*)$ /server/socket.io/$1 [L,QSA]

# 4) If file or directory exists, serve normally
RewriteCond %{REQUEST_FILENAME} -f [OR]
RewriteCond %{REQUEST_FILENAME} -d
RewriteRule ^ - [L]

# 5) Otherwise serve frontend files from drinkmate-main (SPA fallback)
#    Ensure drinkmate-main/index.html exists (static build or SPA output)
RewriteRule ^(.*)$ /drinkmate-main/$1 [L,QSA]
DirectoryIndex /drinkmate-main/index.html
